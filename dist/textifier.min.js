!function(){var t=function(){function t(t,i,n){this.maxWidth=t&&t>=0?t:1/0,this.maxHeight=i&&i>=0?i:1/0,"object"==typeof t?(this.options=t,this.maxHeight=1/0):this.options="object"==typeof i?i:n||{},this.options={characters:this.options.characters&&this.options.characters.length>0?this.options.characters:"01",background:this.options.background||"#00000000",ordered:this.options.ordered||!1,color:this.options.color||0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.font=function(){var t=document.createElement("pre");t.style.display="inline",t.textContent=" ",document.body.appendChild(t);var{width:i,height:n}=t.getBoundingClientRect();return document.body.removeChild(t),{ratio:n/i,height:n,width:i}}()}function i(t,i,n){return.21*t+.72*i+.07*n}return t.COLORED=0,t.GRAYSCALE=1,t.MONOCHROME=2,t.HTML=0,t.CANVAS=1,t.CONSOLE=2,t.prototype.getPixels=function(t){return new Promise(function(i,n){var e=new Image;e.onload=function(){var[t,n]=function(t,i,n,e,o){var h=Math.floor(o*t),r=i;h>n&&(r=Math.floor(r*n/h),h=n);r>e&&(h=Math.floor(h*e/r),r=e);return[h,r]}(e.width,e.height,this.maxWidth,this.maxHeight,this.font.ratio);this.canvas.width=t,this.canvas.height=n,this.ctx.fillStyle=this.options.background,this.ctx.fillRect(0,0,t,n),this.ctx.drawImage(e,0,0,t,n);for(var o=this.ctx.getImageData(0,0,t,n),h=[],r=0;r<o.data.length;r+=4)h.push({r:o.data[r],g:o.data[r+1],b:o.data[r+2],a:o.data[r+3]/255});i({pixels:h,width:t,height:n})}.bind(this),e.onerror=function(){n(new Error("Couldn't load image "+t))},e.src=t}.bind(this))},t.prototype.createCharacters=function(n,e){return this.getPixels(e).then(function(e){var o=[],h="";n==t.CANVAS&&(this.canvas.width=e.width*this.font.width,this.canvas.height=e.height*this.font.height,this.ctx.font="monospace",this.ctx.fillStyle="#00000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height));for(var r=0;r<e.pixels.length;r++){var s,a,c=e.pixels[r].r,d=e.pixels[r].g,l=e.pixels[r].b,p=e.pixels[r].a;this.options.color!=t.COLORED&&(s=i(c,d,l),this.options.color==t.MONOCHROME&&(s=s>127?255:0,p=p>.5?1:0),c=d=l=s),a=0==p?" ":this.options.ordered?this.options.characters[r%this.options.characters.length]:this.options.characters[Math.floor(Math.random()*this.options.characters.length)],n==t.HTML?(" "==a?o.push(a):o.push('<span style="color: rgba('+c+", "+d+", "+l+", "+p+')">'+a+"</span>"),(r+1)%e.width==0&&o.push("\n")):n==t.CANVAS?" "!=a&&(this.ctx.fillStyle="rgba("+c+", "+d+", "+l+", "+p+")",this.ctx.fillText(a,(r+1)%e.width*this.font.width,Math.ceil(r/e.width)*this.font.height)):(" "==a?h+=" ":(h+="%c"+a,o.push("color: rgba("+c+", "+d+", "+l+", "+p+")")),(r+1)%e.width==0&&(h+="\n"))}return n==t.CONSOLE&&o.unshift("\n"+h),o}.bind(this))},t.prototype.write=function(t,i,n){return this.createCharacters(0,t).then(function(t){n||(i.innerHTML="");var e=document.createElement("pre");return e.innerHTML=t.join(""),i.appendChild(e)}).catch(function(t){console.log(t)})},t.prototype.draw=function(t,i,n){return this.createCharacters(1,t).then(function(t){return n||(i.innerHTML=""),i.appendChild(this.canvas)}.bind(this)).catch(function(t){console.log(t)})},t.prototype.log=function(t){return this.createCharacters(2,t).then(function(t){console.log.apply(this,t)}).catch(function(t){console.log(t)})},t}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=Validator:"function"==typeof define&&define.amd?define([],function(){return t}):window.Textifier=t}();